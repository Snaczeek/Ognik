{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/mateu/Desktop/OGNIK/Ognik/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/mateu/Desktop/OGNIK/Ognik/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{React,useEffect,useContext,useState}from'react';import{useParams}from\"react-router-dom\";import CallIcon from\"../assets/phone-call.png\";import CameraIcon from\"../assets/camera.png\";import MicIcon from\"../assets/mic.png\";import PhoneIcon from\"../assets/phone.png\";import EndCall from\"../assets/end-call.png\";import AuthContext from'../context/AuthContext';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var localStream;var remoteStream;var peerConnection;var isVisible=false;var is_in_call=false;var friend_call=\"none\";var isCalling=false;var ConControls=function ConControls(_ref){var _ref$data=_ref.data,data=_ref$data===void 0?null:_ref$data,fcall=_ref.fcall;// Getting username from URL\nvar _useParams=useParams(),username=_useParams.username;var string=username.toString();// const [isVisible, setIsVisible] = useState(false);\n// Getting access to authToken and WebSocket info from AuthContext\nvar _useContext=useContext(AuthContext),WebSocket=_useContext.WebSocket,authToken=_useContext.authToken,user=_useContext.user;// !!! prop for sending ice can using webSockets !!!\n// WebSocket.send(JSON.stringify({\n//     'message': 'message was sent',\n//     'friendName': string,\n//     'type': 'init_call',\n// }))\nvar servers={iceServers:[{urls:['stun:stun.l.google.com:19302','stun:stun2.l.google.com:19302']}]};var setup_ui=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var button,chat,message_list,user1,user2,video_container;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:console.log(\"test1\");// Getting UI element    \n// let callBTN = document.getElementById(\"call-controls\");\nbutton=document.getElementById(\"ConControls-Call-icon\");button.style.visibility=\"hidden\";// Getting chat element\nchat=document.getElementsByClassName(\"message_container_chat\")[0];message_list=document.getElementsByClassName(\"message_list\")[0];// Getting video elemnt\nuser1=document.getElementById('user-1');user2=document.getElementById('user-2');// Getting permisson from the user\n_context.next=9;return navigator.mediaDevices.getUserMedia({video:true,audio:true});case 9:localStream=_context.sent;// getting problem here\nconsole.log('test2');video_container=document.getElementById(\"video_container\");video_container.style.display=\"grid\";// Setting up video container style\n// callBTN.style.display = 'visible';\nuser1.style.visibility='visible';user1.style.height=\"100%\";user2.style.visibility='visible';user2.style.height=\"100%\";isVisible=true;// Setting up src stream for user 1\nuser1.srcObject=localStream;user1.onloadedmetadata=function(e){user1.play();};// uiNav.style.height = \"50vh\";\n// chat.style.height = \"45vh\";\nmessage_list.style.height=\"50vh\";is_in_call=true;case 22:case\"end\":return _context.stop();}},_callee);}));return function setup_ui(){return _ref2.apply(this,arguments);};}();// Changing layout of website\nvar init_call=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:friend_call=string;setup_ui();create_offer();// alert(\"ended\");\ncase 3:case\"end\":return _context2.stop();}},_callee2);}));return function init_call(){return _ref3.apply(this,arguments);};}();var createPeerConnection=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:// Creating connection object\npeerConnection=new RTCPeerConnection(servers);// Creating friend's stream object\nremoteStream=new MediaStream();// Setting html video object to friend's stream\ndocument.getElementById('user-2').srcObject=remoteStream;if(localStream){_context4.next=8;break;}_context4.next=6;return navigator.mediaDevices.getUserMedia({video:true,audio:true});case 6:localStream=_context4.sent;document.getElementById('user-1').srcObject=localStream;case 8:// For every track, tracks are added to localStream (user's stream)\nlocalStream.getTracks().forEach(function(track){peerConnection.addTrack(track,localStream);});// For every track from friend's peer connection, tracks are added to remoteStream (Friend's stream)\npeerConnection.ontrack=function(e){e.streams[0].getTracks().forEach(function(track){remoteStream.addTrack(track);});};// Debuging\npeerConnection.onicecandidate=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(e){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(e.candidate){// console.log('New ICE candidate: ', e.candidate)\nWebSocket.send(JSON.stringify({'message':e.candidate,'friendName':string,'type':'candidate'}));}case 1:case\"end\":return _context3.stop();}},_callee3);}));return function(_x){return _ref5.apply(this,arguments);};}();case 11:case\"end\":return _context4.stop();}},_callee4);}));return function createPeerConnection(){return _ref4.apply(this,arguments);};}();var create_offer=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(){var offer,delay;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:_context5.next=2;return createPeerConnection();case 2:_context5.next=4;return peerConnection.createOffer();case 4:offer=_context5.sent;_context5.next=7;return peerConnection.setLocalDescription(offer);case 7:delay=function delay(ms){return new Promise(function(resolve){return setTimeout(resolve,ms);});};_context5.next=10;return delay(200);case 10:WebSocket.send(JSON.stringify({'message':offer,'friendName':string,'type':'init_call'}));// console.log('Offer: ', offer)\n// console.log(peerConnection)\ncase 11:case\"end\":return _context5.stop();}},_callee5);}));return function create_offer(){return _ref6.apply(this,arguments);};}();var create_answer=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(offer){var answer,delay;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:_context6.next=2;return createPeerConnection();case 2:_context6.next=4;return peerConnection.setRemoteDescription(offer);case 4:_context6.next=6;return peerConnection.createAnswer();case 6:answer=_context6.sent;_context6.next=9;return peerConnection.setLocalDescription(answer);case 9:// console.log(string)\nconsole.log(\"asnwer: |\");console.log(answer);// creating delay to ensure that aswer is created before sending message\n// if not first init of the call wont work :( (I have absolutely no idea how to fix this)\ndelay=function delay(ms){return new Promise(function(resolve){return setTimeout(resolve,ms);});};_context6.next=14;return delay(400);case 14:WebSocket.send(JSON.stringify({'message':answer,'friendName':string,'type':'answer'}));case 15:case\"end\":return _context6.stop();}},_callee6);}));return function create_answer(_x2){return _ref7.apply(this,arguments);};}();var addAnswer=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(answer){return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:if(peerConnection.currentRemoteDescription){_context7.next=4;break;}// console.log(peerConnection) \nconsole.log(peerConnection.currentRemoteDescription);// count++\n_context7.next=4;return peerConnection.setRemoteDescription(answer);case 4:case\"end\":return _context7.stop();}},_callee7);}));return function addAnswer(_x3){return _ref8.apply(this,arguments);};}();var handleCallFromPeer=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(data){var button,delay;return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:if(!data){_context8.next=10;break;}// Debuggin stuff\n// if (data.friend == string)\n// {\n// console.log(data)\n// }\n// If data is type init_call and was send from a friend\nif(data.type==\"init_call\"&&data.friend==string){// Setting flag that will fire off ui calling prompt\nisCalling=true;// Getting accept_call button and adding event listener onclick \n// that will fire of createReqeust function with passed 'data' param\nbutton=document.getElementById(\"call_request_accept_call\");button.addEventListener(\"click\",createRequest);button.myParam=data;}if(data.message.type===\"answer\"&&data.friend==string){// Adding answer\naddAnswer(data.message);// console.log(\"add_answer\")\n// console.log(data.message)\n}if(!(data.type==\"candidate\"&&data.friend==string)){_context8.next=9;break;}// creating delay hack to ensure that create_answer() sends answer object first via websocket\n// possible fix:\n// create system where peer has to accept call and this will ensure time buffer betweem adding Ice Candidates and receiving answer object\n// answer object must be received before adding any Ice Candidates if not Ice Candidates on peer side will be added to null local description (that will throw error)\ndelay=function delay(ms){return new Promise(function(resolve){return setTimeout(resolve,ms);});};_context8.next=7;return delay(1000);case 7:console.log(\"ice tests\");if(peerConnection){console.log(peerConnection.remoteDescription);peerConnection.addIceCandidate(data.message);console.log(\"addIceCandidate\");}case 9:if(data.type==\"end_call\"&&is_in_call&&friend_call==data.friend){handleUserLeft();}case 10:case\"end\":return _context8.stop();}},_callee8);}));return function handleCallFromPeer(_x4){return _ref9.apply(this,arguments);};}();// Creating positive answer to call \nvar createRequest=/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(data){return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1)switch(_context9.prev=_context9.next){case 0:// Saving friend name that user is in call with to var\nfriend_call=data.currentTarget.myParam.friend;// Changing ui \nsetup_ui();// Creating answer ice object and sending it to a peer \ncreate_answer(data.currentTarget.myParam.message);// Making ui call request disappear\nisCalling=false;case 4:case\"end\":return _context9.stop();}},_callee9);}));return function createRequest(_x5){return _ref10.apply(this,arguments);};}();// TO FIX: object stream bug, in new call\nvar handleUserLeft=/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee10(){var uiNav,chat,message_list,button,video_container,user1,user2;return _regeneratorRuntime().wrap(function _callee10$(_context10){while(1)switch(_context10.prev=_context10.next){case 0:// Getting html element\nuiNav=document.getElementsByClassName(\"ConControls\")[0];// Getting whole div that contains input message and list message\nchat=document.getElementsByClassName(\"message_container_chat\")[0];// Getting list that contains messages\nmessage_list=document.getElementsByClassName(\"message_list\")[0];// Changing back height setting\nuiNav.style.height=\"auto\";chat.style.height=\"auto\";// Setting message list to 85% of website height\nmessage_list.style.height=\"85vh\";// Getting html call button (green button that init the call)\nbutton=document.getElementById(\"ConControls-Call-icon\");// Making button visible again\nbutton.style.visibility=\"visible\";// Making div that contains video objects invisible\nvideo_container=document.getElementById(\"video_container\");video_container.style.display=\"none\";// Getting users video objects\nuser1=document.getElementById('user-1');user2=document.getElementById('user-2');// Making them also invinsible \nuser1.style.visibility='hidden';user1.style.height=\"0%\";user2.style.visibility='hidden';user2.style.height=\"0%\";// Setting flags to false\nisVisible=false;is_in_call=false;isCalling=false;// Testing/debuggin/fixing bugs\n// localStream.getTracks().forEach((track) => {\n//     track.stop();\n// })\n// For every track, tracks are added to localStream (user's stream)\n// console.log(peerConnection.getSenders())\n// peerConnection.removeTrack(peerConnection.getSenders()[0])\n// let videoTrack = localStream.getTracks().find(track => track.kind === 'video')\n// localStream.getTracks().forEach((track) => {\n//     console.log(track)\n//     // track.stop();\n//     localStream.removeTrack(track)\n// })\n// closing peer connection (sets connection to 'close' status, it doesn't destroying connection)\npeerConnection.close();// Temporary fix to object stream bug\nwindow.location.reload();// removeTrack()\n// Sending to peer 'end_call' prompt\nWebSocket.send(JSON.stringify({'message':'end call','friendName':string,'type':'end_call'}));case 22:case\"end\":return _context10.stop();}},_callee10);}));return function handleUserLeft(){return _ref11.apply(this,arguments);};}();// Denying incoming call\nvar deny_call=function deny_call(){isCalling=false;// Sending to peer 'end_call' prompt \nWebSocket.send(JSON.stringify({'message':'end call','friendName':string,'type':'end_call'}));};// Toggle user's stream camera\nvar toggle_camera=/*#__PURE__*/function(){var _ref12=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee11(){var videoTrack;return _regeneratorRuntime().wrap(function _callee11$(_context11){while(1)switch(_context11.prev=_context11.next){case 0:// Getting user's stream object\nvideoTrack=localStream.getTracks().find(function(track){return track.kind==='video';});if(videoTrack.enabled){// Disabling video src\nvideoTrack.enabled=false;// Setting background color of button to red\ndocument.getElementById('camera_btn').style.backgroundColor='rgb(255, 80, 80)';}else{// Enabling video src\nvideoTrack.enabled=true;// Setting background color of button to blue\ndocument.getElementById('camera_btn').style.backgroundColor='rgb(102, 153, 255, .8)';}case 2:case\"end\":return _context11.stop();}},_callee11);}));return function toggle_camera(){return _ref12.apply(this,arguments);};}();// Taggle user's stream audio\nvar toggle_audio=/*#__PURE__*/function(){var _ref13=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee12(){var audioTrack;return _regeneratorRuntime().wrap(function _callee12$(_context12){while(1)switch(_context12.prev=_context12.next){case 0:// Getting user's stream object\naudioTrack=localStream.getTracks().find(function(track){return track.kind==='audio';});if(audioTrack.enabled){// Disabling audio src\naudioTrack.enabled=false;// Changing button background to red\ndocument.getElementById('mic_btn').style.backgroundColor='rgb(255, 80, 80)';}else{// Enabling audio src\naudioTrack.enabled=true;// Changing button background to blue\ndocument.getElementById('mic_btn').style.backgroundColor='rgb(102, 153, 255, .8)';}case 2:case\"end\":return _context12.stop();}},_callee12);}));return function toggle_audio(){return _ref13.apply(this,arguments);};}();useEffect(function(){// Adding event listenr that checks if user refreshed/close tab\nwindow.addEventListener('beforeunload',handleUserLeft);// if(is_in_call === true)\n// {\n//     init_call()\n// }\n// else\n// {\n//     // Getting UI element    \n//     let uiNav = document.getElementsByClassName(\"ConControls\")[0];\n//     // Getting chat element\n//     let chat = document.getElementsByClassName(\"message_container_chat\")[0];\n//     let message_list = document.getElementsByClassName(\"message_list\")[0];\n//     uiNav.style.height = \"auto\";\n//     chat.style.height = \"auto\";\n//     message_list.style.height = \"85vh\";\n// }\n// // setup_ui()\n// setIsVisible(false)\n},[]);// Logic for handling incoming call from ws\nhandleCallFromPeer(data);return/*#__PURE__*/_jsxs(\"div\",{className:\"main_uivideo_con\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"ConControls\",children:[/*#__PURE__*/_jsx(\"div\",{id:\"ConControls-friendname\",children:username}),/*#__PURE__*/_jsx(\"div\",{id:\"ConControls-Call-icon\",onClick:init_call,children:/*#__PURE__*/_jsx(\"img\",{src:CallIcon,alt:\"call\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"video_container\",id:\"video_container\",hidden:true,children:[/*#__PURE__*/_jsx(\"video\",{className:\"video-player\",id:\"user-1\",autoPlay:true,playsInline:true}),/*#__PURE__*/_jsx(\"video\",{className:\"video-player\",id:\"user-2\",autoPlay:true,playsInline:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:isCalling?'visible':'hidden',id:\"call_request\",children:[/*#__PURE__*/_jsxs(\"div\",{id:\"call_request_text\",children:[string,\" is calling you!\"]}),/*#__PURE__*/_jsxs(\"div\",{id:\"call_request_controls\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"control-container\",id:\"call_request_accept_call\",children:/*#__PURE__*/_jsx(\"img\",{src:PhoneIcon,alt:\"accept_call\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"control-container\",id:\"leave_btn\",onClick:deny_call,children:/*#__PURE__*/_jsx(\"img\",{src:EndCall,alt:\"deny_call\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:isVisible?'visible':'hidden',id:\"call_controls\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"control-container\",id:\"camera_btn\",onClick:toggle_camera,children:/*#__PURE__*/_jsx(\"img\",{src:CameraIcon,alt:\"camera_btn\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"control-container\",id:\"mic_btn\",onClick:toggle_audio,children:/*#__PURE__*/_jsx(\"img\",{src:MicIcon,alt:\"microphone_btn\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"control-container\",id:\"leave_btn\",onClick:handleUserLeft,children:/*#__PURE__*/_jsx(\"img\",{src:PhoneIcon,alt:\"leave_btn\"})})]})]});};export default ConControls;","map":{"version":3,"names":["React","useEffect","useContext","useState","useParams","CallIcon","CameraIcon","MicIcon","PhoneIcon","EndCall","AuthContext","localStream","remoteStream","peerConnection","isVisible","is_in_call","friend_call","isCalling","ConControls","data","fcall","username","string","toString","WebSocket","authToken","user","servers","iceServers","urls","setup_ui","console","log","button","document","getElementById","style","visibility","chat","getElementsByClassName","message_list","user1","user2","navigator","mediaDevices","getUserMedia","video","audio","video_container","display","height","srcObject","onloadedmetadata","e","play","init_call","create_offer","createPeerConnection","RTCPeerConnection","MediaStream","getTracks","forEach","track","addTrack","ontrack","streams","onicecandidate","candidate","send","JSON","stringify","createOffer","offer","setLocalDescription","delay","ms","Promise","resolve","setTimeout","create_answer","setRemoteDescription","createAnswer","answer","addAnswer","currentRemoteDescription","handleCallFromPeer","type","friend","addEventListener","createRequest","myParam","message","remoteDescription","addIceCandidate","handleUserLeft","currentTarget","uiNav","close","window","location","reload","deny_call","toggle_camera","videoTrack","find","kind","enabled","backgroundColor","toggle_audio","audioTrack"],"sources":["C:/Users/mateu/Desktop/OGNIK/Ognik/frontend/src/components/ConControls.js"],"sourcesContent":["import {React, useEffect, useContext, useState} from 'react'\r\nimport {  useParams } from \"react-router-dom\";\r\nimport CallIcon from \"../assets/phone-call.png\"\r\nimport CameraIcon from \"../assets/camera.png\"\r\nimport MicIcon from \"../assets/mic.png\"\r\nimport PhoneIcon from \"../assets/phone.png\"\r\nimport EndCall from \"../assets/end-call.png\"\r\nimport AuthContext from '../context/AuthContext'\r\n\r\nlet localStream;\r\nlet remoteStream;\r\nlet peerConnection\r\nlet isVisible = false\r\nlet is_in_call = false;\r\nlet friend_call = \"none\"\r\nlet isCalling = false\r\n\r\nconst ConControls = ({data = null, fcall}) => {\r\n    // Getting username from URL\r\n    let { username } = useParams();\r\n    let string = username.toString();\r\n\r\n    // const [isVisible, setIsVisible] = useState(false);\r\n\r\n    // Getting access to authToken and WebSocket info from AuthContext\r\n    let { WebSocket, authToken, user} = useContext(AuthContext)\r\n\r\n    // !!! prop for sending ice can using webSockets !!!\r\n    \r\n    // WebSocket.send(JSON.stringify({\r\n    //     'message': 'message was sent',\r\n    //     'friendName': string,\r\n    //     'type': 'init_call',\r\n    // }))\r\n\r\n\r\n\r\n    const servers = \r\n    {\r\n        iceServers:[\r\n            {\r\n                urls:['stun:stun.l.google.com:19302', 'stun:stun2.l.google.com:19302']\r\n            }\r\n        ]\r\n    } \r\n    \r\n\r\n    let setup_ui = async () => {\r\n        console.log(\"test1\")\r\n        // Getting UI element    \r\n        // let callBTN = document.getElementById(\"call-controls\");\r\n        let button = document.getElementById(\"ConControls-Call-icon\");\r\n        button.style.visibility = \"hidden\";\r\n        // Getting chat element\r\n        let chat = document.getElementsByClassName(\"message_container_chat\")[0];\r\n        let message_list = document.getElementsByClassName(\"message_list\")[0];\r\n        \r\n        // Getting video elemnt\r\n        let user1 = document.getElementById('user-1');\r\n        let user2 = document.getElementById('user-2');\r\n\r\n        // Getting permisson from the user\r\n        localStream = await navigator.mediaDevices.getUserMedia({video: true, audio: true}); // getting problem here\r\n\r\n        console.log('test2')\r\n\r\n        let video_container = document.getElementById(\"video_container\");\r\n        video_container.style.display = \"grid\"\r\n\r\n        // Setting up video container style\r\n        // callBTN.style.display = 'visible';\r\n        user1.style.visibility = 'visible';\r\n        user1.style.height = \"100%\";\r\n        user2.style.visibility = 'visible';\r\n        user2.style.height = \"100%\";\r\n        isVisible = true\r\n        // Setting up src stream for user 1\r\n        user1.srcObject = localStream;\r\n        \r\n        user1.onloadedmetadata = function(e) {\r\n            user1.play();\r\n        };\r\n\r\n        // uiNav.style.height = \"50vh\";\r\n        // chat.style.height = \"45vh\";\r\n        message_list.style.height = \"50vh\";\r\n\r\n        is_in_call = true;\r\n    }\r\n\r\n    // Changing layout of website\r\n    let init_call = async () =>\r\n    {\r\n        friend_call = string\r\n        setup_ui()\r\n\r\n        create_offer()\r\n        \r\n        // alert(\"ended\");\r\n    }\r\n\r\n    let createPeerConnection = async () => {\r\n        // Creating connection object\r\n        peerConnection = new RTCPeerConnection(servers)\r\n\r\n        // Creating friend's stream object\r\n        remoteStream = new MediaStream()\r\n        // Setting html video object to friend's stream\r\n        document.getElementById('user-2').srcObject = remoteStream;\r\n\r\n        if(!localStream){\r\n            localStream = await navigator.mediaDevices.getUserMedia({video:true, audio:true})\r\n            document.getElementById('user-1').srcObject = localStream\r\n        }\r\n\r\n        // For every track, tracks are added to localStream (user's stream)\r\n        localStream.getTracks().forEach((track) => {\r\n            peerConnection.addTrack(track, localStream)\r\n        })\r\n\r\n        // For every track from friend's peer connection, tracks are added to remoteStream (Friend's stream)\r\n        peerConnection.ontrack = (e) => {\r\n            e.streams[0].getTracks().forEach((track) => {\r\n                remoteStream.addTrack(track)\r\n            })\r\n        }\r\n\r\n        // Debuging\r\n        peerConnection.onicecandidate = async (e) => {\r\n            if(e.candidate){\r\n                // console.log('New ICE candidate: ', e.candidate)\r\n                WebSocket.send(JSON.stringify({\r\n                    'message': e.candidate,\r\n                    'friendName': string,\r\n                    'type': 'candidate',\r\n                }))\r\n            }\r\n        }\r\n    }\r\n\r\n    let create_offer = async () => \r\n    {\r\n        await createPeerConnection()\r\n\r\n        let offer = await peerConnection.createOffer()\r\n        // sets local descirpiton and also fires of peerConnection.onicecandidate listener\r\n        await peerConnection.setLocalDescription(offer)\r\n\r\n        const delay = ms => new Promise(\r\n            resolve => setTimeout(resolve, ms)\r\n        );\r\n        await delay(200)\r\n\r\n        WebSocket.send(JSON.stringify({\r\n            'message': offer,\r\n            'friendName': string,\r\n            'type': 'init_call',\r\n        }))\r\n        // console.log('Offer: ', offer)\r\n        // console.log(peerConnection)\r\n    }\r\n\r\n    let create_answer = async (offer) => {\r\n        await createPeerConnection()\r\n\r\n        await peerConnection.setRemoteDescription(offer)\r\n\r\n        let answer = await peerConnection.createAnswer()\r\n        await peerConnection.setLocalDescription(answer)\r\n\r\n        // console.log(string)\r\n        console.log(\"asnwer: |\")\r\n        console.log(answer)\r\n        // creating delay to ensure that aswer is created before sending message\r\n        // if not first init of the call wont work :( (I have absolutely no idea how to fix this)\r\n        const delay = ms => new Promise(\r\n            resolve => setTimeout(resolve, ms)\r\n        );\r\n        await delay(400)\r\n        WebSocket.send(JSON.stringify({\r\n            'message': answer,\r\n            'friendName': string,\r\n            'type': 'answer',\r\n        }))\r\n\r\n    }\r\n\r\n    let addAnswer = async (answer) => {\r\n        // console.log(\"tests: \")\r\n        // console.log(peerConnection)\r\n        if (!peerConnection.currentRemoteDescription) {\r\n            // console.log(peerConnection) \r\n            console.log(peerConnection.currentRemoteDescription)\r\n            // count++\r\n            await peerConnection.setRemoteDescription(answer);\r\n        }\r\n      };\r\n\r\n    let handleCallFromPeer = async (data) => {\r\n        // quick delay hack (not working in this case :( i hate life )\r\n        // const delay = ms => new Promise(\r\n        //     resolve => setTimeout(resolve, ms)\r\n        // );\r\n        // await delay(300)\r\n        if (data)\r\n        {\r\n            // Debuggin stuff\r\n            // if (data.friend == string)\r\n            // {\r\n                // console.log(data)\r\n            // }\r\n            // If data is type init_call and was send from a friend\r\n            if (data.type == \"init_call\" && data.friend == string)\r\n            {\r\n                // Setting flag that will fire off ui calling prompt\r\n                isCalling = true\r\n                // Getting accept_call button and adding event listener onclick \r\n                // that will fire of createReqeust function with passed 'data' param\r\n                let button = document.getElementById(\"call_request_accept_call\")\r\n                button.addEventListener(\"click\", createRequest)\r\n                button.myParam = data\r\n            }\r\n            \r\n            if (data.message.type === \"answer\" && data.friend == string)\r\n            {\r\n                // Adding answer\r\n                addAnswer(data.message)\r\n                // console.log(\"add_answer\")\r\n                // console.log(data.message)\r\n            }\r\n            \r\n            if (data.type == \"candidate\" && data.friend == string)\r\n            {\r\n                // creating delay hack to ensure that create_answer() sends answer object first via websocket\r\n                // possible fix:\r\n                // create system where peer has to accept call and this will ensure time buffer betweem adding Ice Candidates and receiving answer object\r\n                // answer object must be received before adding any Ice Candidates if not Ice Candidates on peer side will be added to null local description (that will throw error)\r\n                const delay = ms => new Promise(\r\n                    resolve => setTimeout(resolve, ms)\r\n                );\r\n                await delay(1000)\r\n                console.log(\"ice tests\")\r\n                if(peerConnection){\r\n                    console.log(peerConnection.remoteDescription)\r\n                    peerConnection.addIceCandidate(data.message)\r\n\r\n                    console.log(\"addIceCandidate\")\r\n                }\r\n            }\r\n\r\n            if (data.type == \"end_call\" && is_in_call && friend_call == data.friend)\r\n            {\r\n                handleUserLeft()\r\n            }\r\n        }\r\n\r\n        // isCalling(false)\r\n    }\r\n    \r\n    // Creating positive answer to call \r\n    let createRequest = async (data) => {\r\n\r\n        // Saving friend name that user is in call with to var\r\n        friend_call = data.currentTarget.myParam.friend\r\n        // Changing ui \r\n        setup_ui()\r\n        // Creating answer ice object and sending it to a peer \r\n        create_answer(data.currentTarget.myParam.message)\r\n        \r\n        // Making ui call request disappear\r\n        isCalling = false\r\n    }\r\n\r\n    // TO FIX: object stream bug, in new call\r\n    let handleUserLeft = async () => {\r\n        \r\n        // Getting html element\r\n        let uiNav = document.getElementsByClassName(\"ConControls\")[0];\r\n        // Getting whole div that contains input message and list message\r\n        let chat = document.getElementsByClassName(\"message_container_chat\")[0];\r\n        // Getting list that contains messages\r\n        let message_list = document.getElementsByClassName(\"message_list\")[0];\r\n\r\n        // Changing back height setting\r\n        uiNav.style.height = \"auto\";\r\n        chat.style.height = \"auto\";\r\n        // Setting message list to 85% of website height\r\n        message_list.style.height = \"85vh\";\r\n        \r\n        // Getting html call button (green button that init the call)\r\n        let button = document.getElementById(\"ConControls-Call-icon\");\r\n        // Making button visible again\r\n        button.style.visibility = \"visible\";\r\n        \r\n        // Making div that contains video objects invisible\r\n        let video_container = document.getElementById(\"video_container\");\r\n        video_container.style.display = \"none\"\r\n        \r\n        // Getting users video objects\r\n        let user1 = document.getElementById('user-1');\r\n        let user2 = document.getElementById('user-2');\r\n        \r\n        // Making them also invinsible \r\n        user1.style.visibility = 'hidden';\r\n        user1.style.height = \"0%\";\r\n        user2.style.visibility = 'hidden';\r\n        user2.style.height = \"0%\";\r\n        \r\n        // Setting flags to false\r\n        isVisible = false\r\n        is_in_call = false\r\n        isCalling = false\r\n        \r\n        // Testing/debuggin/fixing bugs\r\n\r\n        // localStream.getTracks().forEach((track) => {\r\n            //     track.stop();\r\n            // })\r\n\r\n        // For every track, tracks are added to localStream (user's stream)\r\n        \r\n    \r\n        // console.log(peerConnection.getSenders())\r\n        // peerConnection.removeTrack(peerConnection.getSenders()[0])\r\n\r\n        // let videoTrack = localStream.getTracks().find(track => track.kind === 'video')\r\n        // localStream.getTracks().forEach((track) => {\r\n        //     console.log(track)\r\n        //     // track.stop();\r\n        //     localStream.removeTrack(track)\r\n        // })\r\n\r\n        // closing peer connection (sets connection to 'close' status, it doesn't destroying connection)\r\n        peerConnection.close()\r\n        // Temporary fix to object stream bug\r\n        window.location.reload()\r\n        // removeTrack()\r\n        \r\n        // Sending to peer 'end_call' prompt\r\n        WebSocket.send(JSON.stringify({\r\n            'message': 'end call',\r\n            'friendName': string,\r\n            'type': 'end_call',\r\n        }))\r\n    }\r\n\r\n    // Denying incoming call\r\n    let deny_call = () => {\r\n        isCalling = false\r\n\r\n        // Sending to peer 'end_call' prompt \r\n        WebSocket.send(JSON.stringify({\r\n            'message': 'end call',\r\n            'friendName': string,\r\n            'type': 'end_call',\r\n        }))\r\n    }\r\n\r\n    // Toggle user's stream camera\r\n    let toggle_camera = async () => {\r\n        // Getting user's stream object\r\n        let videoTrack = localStream.getTracks().find(track => track.kind === 'video')\r\n\r\n        if (videoTrack.enabled)\r\n        {\r\n            // Disabling video src\r\n            videoTrack.enabled = false\r\n            // Setting background color of button to red\r\n            document.getElementById('camera_btn').style.backgroundColor = 'rgb(255, 80, 80)'\r\n        }\r\n        else\r\n        {\r\n            // Enabling video src\r\n            videoTrack.enabled = true\r\n            // Setting background color of button to blue\r\n            document.getElementById('camera_btn').style.backgroundColor = 'rgb(102, 153, 255, .8)'\r\n        }\r\n    }\r\n\r\n    // Taggle user's stream audio\r\n    let toggle_audio = async () => {\r\n        // Getting user's stream object\r\n        let audioTrack = localStream.getTracks().find(track => track.kind === 'audio')\r\n\r\n        if (audioTrack.enabled)\r\n        {\r\n            // Disabling audio src\r\n            audioTrack.enabled = false\r\n            // Changing button background to red\r\n            document.getElementById('mic_btn').style.backgroundColor = 'rgb(255, 80, 80)'\r\n        }\r\n        else\r\n        {\r\n            // Enabling audio src\r\n            audioTrack.enabled = true\r\n            // Changing button background to blue\r\n            document.getElementById('mic_btn').style.backgroundColor = 'rgb(102, 153, 255, .8)'\r\n        }\r\n    }\r\n    \r\n    \r\n    useEffect(()=> {\r\n        // Adding event listenr that checks if user refreshed/close tab\r\n        window.addEventListener('beforeunload', handleUserLeft)\r\n        // if(is_in_call === true)\r\n        // {\r\n        //     init_call()\r\n        // }\r\n        // else\r\n        // {\r\n        //     // Getting UI element    \r\n        //     let uiNav = document.getElementsByClassName(\"ConControls\")[0];\r\n        //     // Getting chat element\r\n        //     let chat = document.getElementsByClassName(\"message_container_chat\")[0];\r\n        //     let message_list = document.getElementsByClassName(\"message_list\")[0];\r\n        //     uiNav.style.height = \"auto\";\r\n        //     chat.style.height = \"auto\";\r\n        //     message_list.style.height = \"85vh\";\r\n        // }\r\n        // // setup_ui()\r\n\r\n        // setIsVisible(false)\r\n    }, [])\r\n\r\n    // Logic for handling incoming call from ws\r\n    handleCallFromPeer(data)\r\n    \r\n    return (\r\n        <div className='main_uivideo_con'>\r\n            <div className='ConControls'>\r\n                <div id='ConControls-friendname'>{username}</div>\r\n                <div id='ConControls-Call-icon' onClick={init_call}><img src={CallIcon} alt=\"call\"/></div>\r\n            </div>\r\n            <div className='video_container' id='video_container' hidden>\r\n                <video className=\"video-player\" id='user-1' autoPlay playsInline ></video>\r\n                <video className=\"video-player\" id='user-2' autoPlay playsInline ></video>\r\n            </div>\r\n            <div className={isCalling ? 'visible' : 'hidden'} id='call_request'>\r\n                <div id='call_request_text'>\r\n                    {string} is calling you!\r\n                </div>\r\n                <div id='call_request_controls'>\r\n                    <div className='control-container' id='call_request_accept_call'>\r\n                        <img src={PhoneIcon} alt='accept_call' />\r\n                    </div>\r\n                    <div className='control-container' id='leave_btn' onClick={deny_call}>\r\n                        <img src={EndCall} alt='deny_call'/>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div className={isVisible ? 'visible' : 'hidden'} id='call_controls'>\r\n                <div className=\"control-container\" id=\"camera_btn\" onClick={toggle_camera}>\r\n                    <img src={CameraIcon} alt='camera_btn' />\r\n                </div>\r\n                <div className=\"control-container\" id=\"mic_btn\" onClick={toggle_audio}>\r\n                    <img src={MicIcon} alt='microphone_btn' />\r\n                </div>\r\n                <div className=\"control-container\" id=\"leave_btn\" onClick={handleUserLeft}>\r\n                    <img src={PhoneIcon} alt='leave_btn' />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default ConControls"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}